\newlength\la@teacher@textwidth
\newlength\la@teacher@colsep
\newlength\la@teacher@fullwidth
\newlength\la@teacher@pagewidth
\newlength\la@teacher@spinemargin
\newlength\la@teacher@foremargin
\newlength\la@teacher@innermargin

\setlength{\la@teacher@pagewidth}{315mm}
\setlength{\la@teacher@foremargin}{.75\la@student@foremargin}
\setlength{\la@teacher@spinemargin}{\la@student@spinemargin}
\setlength{\la@teacher@innermargin}{\la@teacher@foremargin}

\setlength{\la@teacher@colsep}{\la@student@foremargin+\la@teacher@innermargin}
\setlength{\la@teacher@textwidth}{
 	 \la@teacher@pagewidth
	-\la@student@textwidth
	-\la@teacher@colsep
	-\la@teacher@spinemargin
	-\la@teacher@foremargin
}
\setlength{\la@teacher@fullwidth}{
	\la@teacher@pagewidth
	-\la@teacher@foremargin
	-\la@teacher@spinemargin
}

\setstocksize{\la@student@pageheight}{\la@teacher@pagewidth}
\settrimmedsize{\la@student@pageheight}{\la@teacher@pagewidth}{*}

\setlrmarginsandblock{\la@student@spinemargin}{\la@teacher@foremargin}{*}
\setulmarginsandblock{\la@student@uppermargin}{\la@student@lowermargin}{*}

\checkandfixthelayout%

\newcounter{studentpage}
\newcounter{teacherpage}

\makepagestyle{teacherpage}
\makeevenfoot{teacherpage}{}{\la@evenpagenumber[\currentvolcolor]}{}
\makeoddfoot{teacherpage}{}{\la@oddpagenumber[\currentvolcolor]}{}

\newif\ifteacherpage\teacherpagefalse
\newif\ifteachersection\teachersectionfalse
\newenvironment{la@teacherpage}[1]{%
    \clearpage
	\teacherpagetrue
    \renewcommand{\thepage}{\arabic{chapter}.\Alph{page}}
    \setcounter{studentpage}{\value{page}}
    \setcounter{page}{\value{teacherpage}}
    \clearpage
    \la@teacher@backgroundcolor{boxbackground}
    \par{\raggedright\sectiontitlefont\color{\currentvolcolor}#1}\par
    \vspace{.5\la@titleafterskip}
	\thispagestyle{teacherpage}
	\begin{multicols}{2}
}{
	\end{multicols}
	\teacherpagefalse
	\setcounter{teacherpage}{\value{page}}
	\setcounter{page}{\value{studentpage}}
	\renewcommand{\thepage}{\arabic{page}}
	\color{black}
}

\pretocmd{\la@teacherpage}{\teachercol@off}{}{}

\newenvironment{teachersection}[1]{
    \teachersectiontrue
    \begin{la@teacherpage}{#1}
    \addcontentsline{toc}{section}{#1}
}{
    \end{la@teacherpage} 
    \teachersectionfalse
}

\newenvironment{teacherintroduction}{
    \begin{la@teacherpage}{Introdução ao Professor}
    \addcontentsline{toc}{section}{Introdução ao Professor}
    }{
    \end{la@teacherpage}
}   

\newenvironment{longteacher}[1]{
    \teacherenvtrue
    \begin{la@teacherpage}{#1}
}{
    \end{la@teacherpage}
    \clearpage\thispagestyle{livroaberto}\teachercol@on
}


\newcommand{\la@notteacherpage}{\ClassError{livroabertoem}{Outside teachers's page}{%
	You should only use this command in a teacher page}
}

% paracol definitions
\twosided%
\setcolumnwidth{\la@student@textwidth/\la@teacher@colsep,\la@teacher@textwidth}
\newcommand{\la@teacher@backgroundcolor}[1]{%
	\backgroundcolor{c[1] (\la@teacher@innermargin,25mm) (25mm,250mm)}{#1}
}

\makepsmarks{empty}{\la@teacher@backgroundcolor{white}}
\renewcommand{\teachercol@on}{     
    \ifteacher\ifparacol\else
		\paracol{2} % starts double column at the student's main text.
		\paracoltrue
	\fi\else\fi
}

\renewcommand{\teachercol@off}{
    \ifteacher\ifparacol
		\endparacol
		\paracolfalse
	\else\fi\else\fi
}

\AtEndDocument{
	\clearpage
    \teachercol@off%
}
