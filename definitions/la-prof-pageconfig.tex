\newlength\la@teacher@textwidth
\newlength\la@teacher@colsep
\newlength\la@teacher@fullwidth
\newlength\la@teacher@pagewidth
\newlength\la@teacher@spinemargin
\newlength\la@teacher@foremargin
\newlength\la@teacher@innermargin

\setlength{\la@teacher@pagewidth}{315mm}
\setlength{\la@teacher@foremargin}{.75\la@student@foremargin}
\setlength{\la@teacher@spinemargin}{\la@student@spinemargin}
\setlength{\la@teacher@innermargin}{\la@teacher@foremargin}

\setlength{\la@teacher@colsep}{\la@student@foremargin+\la@teacher@innermargin}
\setlength{\la@teacher@textwidth}{
	\la@teacher@pagewidth
	-\la@student@textwidth
	-\la@teacher@colsep
	-\la@teacher@spinemargin
	-\la@teacher@foremargin
}
\setlength{\la@teacher@fullwidth}{
	\la@teacher@pagewidth
	-\la@teacher@foremargin
	-\la@teacher@spinemargin
}

\setstocksize{\la@student@pageheight}{\la@teacher@pagewidth}
\settrimmedsize{\la@student@pageheight}{\la@teacher@pagewidth}{*}

\setlrmarginsandblock{\la@student@spinemargin}{\la@teacher@foremargin}{*}
\setulmarginsandblock{\la@student@uppermargin}{\la@student@lowermargin}{*}

\checkandfixthelayout%


\newtoggle{teacherenv}


\newenvironment{teacher}{%
    \par
    \toggletrue{teacherenv}
    \switchcolumn*
		\raggedright
    \la@widelist
}{
    \hfill
    \switchcolumn
    \la@defaultlist
    \togglefalse{teacherenv}
}

\newcommand{\la@notteacherenv}{\ClassError{livroabertoem}{Not in teachers's environment}{%
			You should only use this command for teacher's content}
}

\newcounter{teacherpage}
\makepagestyle{teacherpage}
\makeevenfoot{teacherpage}{}{\la@evenpagenumber[\currentvolcolor]}{}
\makeoddfoot{teacherpage}{}{\la@oddpagenumber[\currentvolcolor]}{}

\newcommand{\la@teacherpage}{
	\cleardoublepage
	\pagestyle{teacherpage}
	\begin{multicols}{2}
}

\newenvironment{teacherpage}{%
	\iftoggle{paracol}{\teachercol@off}{}
	\la@teacherpage
}{\end{multicols}}



% paracol definitions
\twosided%
\setcolumnwidth{\la@student@textwidth/\la@teacher@colsep,\la@teacher@textwidth}
\newcommand{\la@teacher@backgroundcolor}{%
    \backgroundcolor{c[1] (\la@teacher@innermargin,25mm) (25mm,250mm)}{boxbackground}}

\newcommand{\teachercol@on}{     
	\iftoggle{teacher}{
		\iftoggle{paracol}{
		}{
			\la@teacher@backgroundcolor
			\begin{paracol}{2} % starts double column at the student's main text.
			\toggletrue{paracol}
		}
	}
}

\newcommand{\teachercol@off}{
	\iftoggle{teacher}{
    \iftoggle{paracol}{
			\end{paracol}
			\togglefalse{paracol}
    }
	}
}

\AtEndDocument{
	\clearpage
    \teachercol@off%
}
