\RequirePackage[explicit]{titlesec}


% Defines the banner used for the sections

\newcommand{\la@bannerstyle}[1]{
	\tikzset{external/export next = false}

	\begin{tikzpicture}[remember picture, scale=1.3]
		\filldraw [\currentcolor] 
			(-3.00mm,0.00mm) coordinate (a) -- ++(30.00mm,0.00mm) 
			arc [
				start angle=90, end angle=0, x radius=2.00mm, y radius=2.00mm
			] coordinate (a1) -- ++(0.00mm,-2.00mm) coordinate (b1) 
			arc [
				start angle=180, end angle=270, x radius=2.00mm, y radius=2.00mm
			] coordinate (b) -- ++(-30.00mm, 0.00mm) 
			arc [
				start angle=270, end angle=180, x radius=2.00mm, y radius=2.00mm
			] -- ++(0.00mm,2.00mm) 
			arc [
				start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm
			] -- cycle;

		\node (explore) at ($(a)!0.5!(b)$) [white] {\titlefont\MakeUppercase{\la@banner@title}};

		\draw [\currentcolor, thick] (b) --++ ($(\la@studenttextwidth,0.00mm)+(-72 mm,0 mm)$); % changed
		\node (title) at ($(a1)!0.5!(b1)$) [right] {\MakeUppercase{#1}};
	\end{tikzpicture}
}


\newcommand{\la@exercisebanner}{
	\tikzset{external/export next=false}

	\begin{tikzpicture}[remember picture, external/export=false]
		\draw [draw=cor2, very thick] (-3.00mm,0.00mm) -- ++(0.00mm,2.00mm) 
			-- ++(\textwidth , 0.00mm) -- ++(0mm,-2mm);% line

		\fill [draw=cor2, very thick , fill=cor1] 
			($(\textwidth/2 , 0mm) + (19mm,6mm)$) -- ++(0.00mm,-5.5 mm) coordinate (line1) 
			arc [
				start angle=0, end angle=-90, x radius=2.00mm, y radius=2.00mm
			] -| ++(-38.00mm , 0.00mm) -- ++ (0mm, 5.5 mm) coordinate (line2) 
			arc [
				start angle=180, end angle=90, x radius=2.00mm, y radius=2.00mm
			] -- cycle;

		\node (exercise) at ($(line1)!0.5!(line2) + (0 mm, .8 mm)$) [text=white, font=\thirdtitlefont\Large] {EXERCÍCIOS};%\fontsize{13pt}{0}
	\end{tikzpicture}
}



\titleclass{\la@banner}{straight}[\section]
	\providecommand*{\toclevel@la@banner}{1}
	\titlespacing{\la@banner}{0pt}{8mm}{3pt}
	\titleformat{\la@banner}[hang]{\bannerfont}{\la@bannercounter}{0pt}{%
		\la@bannerstyle{#1}
		\la@defaultlist%
	}	

\titleclass{\la@exercise}{straight}[\chapter]
	\providecommand*{\toclevel@la@exercise}{1}
	\titlespacing{\la@exercise}{0pt}{8mm}{1mm}
	\titleformat{\la@exercise}[hang]{\bannerfont}{\theexercise}{0pt}{%
		\la@exercisebanner		
	}



% Formatação dos comandos \section e \subsection

\titleformat{\section}{
	\color{\currentcolor}\normalfont\semihuge\bfseries
	}{\thesection}{1em}{#1 \phantomsection}

	\titlespacing*{\section}{0pt}{2mm}{1mm}
	\renewcommand{\toclevel@section}{1}

\titleformat{\subsection}{
	\color{\currentcolor}\normalfont\Large\bfseries
	}{\thesection}{1em}{#1}

	\titlespacing*{\subsection}{0pt}{2mm}{1mm}
	\renewcommand{\toclevel@subsection}{4}

\titleformat{\paragraph}{
	\color{\currentcolor}\normalfont\large\bfseries
	}{\thesubsection}{1em}{#1}
		
	\titlespacing*{\paragraph}{0pt}{1mm}{1mm}
	\renewcommand{\toclevel@paragraph}{5}



% Custom section titles definitions

\newcounter{explore}

\newcommand{\explore}[1]{%
	\def\currentcolor{session1}
	\def\la@banner@title{Explorando}
	\def\la@bannercounter{\theexplore}
	\cleardoublepage%	
	\thispagestyle{livroaberto}
	\iftoggle{teacher}{%
		\iftoggle{paracol}{}{%
			\la@prof@backgroundcolor
			\begin{paracol}{2} % starts double column at the student's main text.
			\toggletrue{paracol}
		}
	}{}
	\la@banner{%
		\texorpdfstring{}{\la@banner@title: }#1
	}
	\la@defaultlist
}

\AtEndDocument{
    \iftoggle{paracol}{
        \end{paracol}
    }{}
}


\newcounter{practice}

\newcommand{\practice}[1]{%
	\def\currentcolor{session2}
	\def\la@banner@title{Praticando}
	\def\la@bannercounter{\thepractice}
	\la@banner{%
		\texorpdfstring{}{\la@banner@title: }#1
	}
	\la@defaultlist
}


\newcounter{know}

\newcommand{\know}[1]{%
	\def\currentcolor{session3}
	\def\la@banner@title{Para saber \raisebox{-2.25pt}{\Huge{+}}}
	\def\la@bannercounter{\theknow}
	\la@banner{%
		\texorpdfstring{}{\la@banner@title: }#1
	}
	\la@defaultlist
}


\newcounter{arrange}

\newcommand{\arrange}[1]{%
	\def\currentcolor{session4}
	\def\la@banner@title{Organizando}
	\def\la@bannercounter{\thearrange}
	\la@banner{%
		\texorpdfstring{}{\la@banner@title: }#1
	}
	\la@defaultlist
}


\newcounter{exercise}

\newcommand{\exercise}{	
	\def\currentcolor{cor1}
	\la@exercise{\texorpdfstring{}{Exercícios}}
	\exerciselist%
}



\newcommand{\expandtocdepth}[1][]{%
	\renewcommand{\toclevel@section}{1}
	\renewcommand{\toclevel@subsection}{4}
	\renewcommand{\toclevel@paragraph}{5}
	\renewcommand{\toclevel@subparagraph}{6}

	\renewcommand{\toclevel@exploresec}{2}
	\renewcommand{\toclevel@practicesec}{2}
	\renewcommand{\toclevel@arrangesec}{2}
	\setcounter{tocdepth}{2}

	\IfStrEqCase{#1}{%
		{}{
}%
		{know}{
			\renewcommand{\toclevel@knowsec}{2}
		}%
		{exercise}{
			\renewcommand{\toclevel@exercisesec}{2}
		}%
		{know, exercise}{
			\renewcommand{\toclevel@knowsec}{2}
			\renewcommand{\toclevel@exercisesec}{2}
		}
	}[%
	Apenas os valores ``know'' e ``exercise'' são permitidos.
	]%
}


\newcounter{anexo}[chapter]

\newcommand{\anexo}[1]{
	\clearpage
	\stepcounter{anexo}
	\begin{center}
		\huge{\titem{Anexo \theanexo}}
	\end{center}
}